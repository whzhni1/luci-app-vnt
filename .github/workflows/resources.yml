name: List Files

on:
  workflow_dispatch:

jobs:
  list:
    runs-on: ubuntu-latest
    steps:
      - name: Clone and List
        run: |
          git clone --depth 1 https://github.com/immortalwrt/luci.git repo
          cd repo/themes/luci-theme-bootstrap
          
          echo "========== ğŸŒ² ç›®å½•ç»“æ„ =========="
          tree -a
          
          echo ""
          echo "========== ğŸ“ æ‰€æœ‰ç›®å½• =========="
          find . -type d | sed 's|^\./||' | grep -v '^\.$' | sort
          
          echo ""
          echo "========== ğŸ“„ æ‰€æœ‰æ–‡ä»¶ =========="
          find . -type f | sed 's|^\./||' | sort
          
          echo ""
          echo "========== ğŸ”— åŸå§‹é“¾æ¥ =========="
          BASE="https://raw.githubusercontent.com/immortalwrt/luci/master/themes/luci-theme-bootstrap"
          find . -type f | sed 's|^\./||' | sort | while read f; do
            echo "$BASE/$f"
          done

      - name: Pack tar (åŸå§‹ç»“æ„)
        run: |
          cd repo/themes
          tar -cvf luci-theme-bootstrap.tar luci-theme-bootstrap

      - name: Upload tar (ä¿ç•™ç›®å½•ç»“æ„)
        uses: actions/upload-artifact@v4
        with:
          name: luci-theme-bootstrap-tar
          path: repo/themes/luci-theme-bootstrap.tar

      - name: Upload full (å±•å¼€æ‰€æœ‰æ–‡ä»¶)
        uses: actions/upload-artifact@v4
        with:
          name: luci-theme-bootstrap
          path: repo/themes/luci-theme-bootstrap

      - name: Pack flattened version (æ‰å¹³åŒ–æ‰€æœ‰æ–‡ä»¶)
        run: |
          mkdir -p flat/luci-theme-bootstrap
          cd repo/themes/luci-theme-bootstrap

          # æŠŠæ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ° flat/luci-theme-bootstrapï¼ˆä¸ä¿ç•™ç›®å½•ç»“æ„ï¼‰
          find . -type f | while read f; do
            cp "$f" "../../../flat/luci-theme-bootstrap/$(basename "$f")"
          done

          cd ../../../flat
          tar -cvf luci-theme-bootstrap-flat.tar luci-theme-bootstrap

      - name: Upload flattened tar
        uses: actions/upload-artifact@v4
        with:
          name: luci-theme-bootstrap-flat
          path: flat/luci-theme-bootstrap-flat.tar
